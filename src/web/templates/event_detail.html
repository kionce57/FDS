{% extends "base.html" %}

{% block title %}äº‹ä»¶è©³æƒ… - {{ event.event_id }}{% endblock %}

{% block content %}
<div class="page-header">
    <div class="breadcrumb">
        <a href="/">å„€è¡¨æ¿</a> / <a href="/events">äº‹ä»¶åˆ—è¡¨</a> / <span>{{ event.event_id }}</span>
    </div>
    <h1>ğŸ“¹ äº‹ä»¶è©³æƒ…</h1>
</div>

<!-- äº‹ä»¶è³‡è¨Š -->
<section class="section">
    <h2 class="section-title">äº‹ä»¶è³‡è¨Š</h2>
    <div class="detail-card">
        <div class="detail-grid">
            <div class="detail-item">
                <label>äº‹ä»¶ ID</label>
                <code>{{ event.event_id }}</code>
            </div>
            <div class="detail-item">
                <label>ç™¼ç”Ÿæ™‚é–“</label>
                <span>{{ event.created_at_local }}</span>
            </div>
            <div class="detail-item">
                <label>ISO æ™‚é–“</label>
                <span>{{ event.created_at_iso }}</span>
            </div>
            <div class="detail-item">
                <label>é€šçŸ¥æ¬¡æ•¸</label>
                <span>{{ event.notification_count }}</span>
            </div>
            <div class="detail-item">
                <label>å½±ç‰‡ç‹€æ…‹</label>
                {% if event.has_clip %}
                <span class="badge badge-success">âœ“ æœ‰å½±ç‰‡</span>
                {% else %}
                <span class="badge badge-secondary">â€” ç„¡å½±ç‰‡</span>
                {% endif %}
            </div>
            {% if event.clip_path %}
            <div class="detail-item">
                <label>å½±ç‰‡è·¯å¾‘</label>
                <code>{{ event.clip_path }}</code>
            </div>
            {% endif %}
        </div>
    </div>
</section>

<!-- å½±ç‰‡æ’­æ”¾å™¨ -->
{% if event.has_clip %}
<section class="section">
    <h2 class="section-title">å½±ç‰‡æ’­æ”¾</h2>
    <div class="video-container">
        <video controls preload="metadata" class="video-player">
            <source src="/api/events/{{ event.event_id }}/clip" type="video/mp4">
            æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å½±ç‰‡æ’­æ”¾ã€‚
        </video>
    </div>
    <div class="video-actions">
        <a href="/api/events/{{ event.event_id }}/clip" download="{{ event.event_id }}.mp4" class="btn btn-secondary">
            ğŸ“¥ ä¸‹è¼‰å½±ç‰‡
        </a>
    </div>
</section>
{% else %}
<section class="section">
    <div class="empty-state">
        <div class="empty-icon">ğŸ¬</div>
        <p>æ­¤äº‹ä»¶æ²’æœ‰å½±ç‰‡è¨˜éŒ„</p>
        <p class="text-muted">å½±ç‰‡å¯èƒ½å·²è¢«æ¸…ç†æˆ–å¾æœªéŒ„è£½</p>
    </div>
</section>
{% endif %}

<!-- æ“ä½œæŒ‰éˆ• -->
<section class="section">
    <div class="action-bar">
        <a href="/events" class="btn btn-secondary">â† è¿”å›åˆ—è¡¨</a>
        <button class="btn btn-danger" onclick="deleteEvent()">ğŸ—‘ï¸ åˆªé™¤äº‹ä»¶</button>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
async function deleteEvent() {
    const eventId = '{{ event.event_id }}';
    
    if (!confirm(`ç¢ºå®šè¦åˆªé™¤äº‹ä»¶ ${eventId}ï¼Ÿ\næ­¤æ“ä½œæœƒåŒæ™‚åˆªé™¤ç›¸é—œå½±ç‰‡ã€‚`)) {
        return;
    }
    
    try {
        const response = await fetch(`/api/events/${eventId}`, {
            method: 'DELETE'
        });
        
        if (response.ok) {
            alert('äº‹ä»¶å·²åˆªé™¤');
            window.location.href = '/events';
        } else {
            const data = await response.json();
            alert(`åˆªé™¤å¤±æ•—: ${data.detail}`);
        }
    } catch (error) {
        alert(`åˆªé™¤å¤±æ•—: ${error.message}`);
    }
}
</script>
{% endblock %}
