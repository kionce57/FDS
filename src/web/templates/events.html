{% extends "base.html" %}

{% block title %}äº‹ä»¶åˆ—è¡¨ - FDS Dashboard{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ğŸ“‹ äº‹ä»¶åˆ—è¡¨</h1>
    <p class="subtitle">è·Œå€’åµæ¸¬äº‹ä»¶è¨˜éŒ„</p>
</div>

<!-- ç¯©é¸èˆ‡çµ±è¨ˆ -->
<section class="section">
    <div class="filter-bar">
        <div class="filter-info">
            <span class="total-count">å…± {{ total }} ç­†è¨˜éŒ„</span>
        </div>
        <div class="filter-actions">
            <button class="btn btn-secondary" onclick="refreshEvents()">ğŸ”„ é‡æ–°æ•´ç†</button>
        </div>
    </div>
</section>

<!-- äº‹ä»¶è¡¨æ ¼ -->
<section class="section">
    {% if events %}
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>äº‹ä»¶ ID</th>
                    <th>æ™‚é–“</th>
                    <th>å½±ç‰‡</th>
                    <th>é€šçŸ¥æ¬¡æ•¸</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for event in events %}
                <tr>
                    <td class="event-id-cell">
                        <code>{{ event.event_id }}</code>
                    </td>
                    <td>{{ event.created_at_local }}</td>
                    <td>
                        {% if event.has_clip %}
                        <span class="badge badge-success">âœ“ æœ‰å½±ç‰‡</span>
                        {% else %}
                        <span class="badge badge-secondary">â€” ç„¡å½±ç‰‡</span>
                        {% endif %}
                    </td>
                    <td>{{ event.notification_count }}</td>
                    <td class="actions-cell">
                        <a href="/events/{{ event.event_id }}" class="btn btn-primary btn-sm">æŸ¥çœ‹</a>
                        <button class="btn btn-danger btn-sm" onclick="deleteEvent('{{ event.event_id }}')">åˆªé™¤</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- åˆ†é  -->
    {% if total_pages > 1 %}
    <div class="pagination">
        {% if page > 1 %}
        <a href="/events?page={{ page - 1 }}&per_page={{ per_page }}" class="btn btn-secondary">â† ä¸Šä¸€é </a>
        {% endif %}
        
        <span class="page-info">ç¬¬ {{ page }} / {{ total_pages }} é </span>
        
        {% if page < total_pages %}
        <a href="/events?page={{ page + 1 }}&per_page={{ per_page }}" class="btn btn-secondary">ä¸‹ä¸€é  â†’</a>
        {% endif %}
    </div>
    {% endif %}

    {% else %}
    <div class="empty-state">
        <div class="empty-icon">ğŸ“­</div>
        <p>å°šç„¡äº‹ä»¶è¨˜éŒ„</p>
        {% if not db_connected %}
        <p class="text-muted">è³‡æ–™åº«æœªé€£ç·šæˆ–ä¸å­˜åœ¨</p>
        {% endif %}
    </div>
    {% endif %}
</section>
{% endblock %}

{% block extra_scripts %}
<script>
function refreshEvents() {
    location.reload();
}

async function deleteEvent(eventId) {
    if (!confirm(`ç¢ºå®šè¦åˆªé™¤äº‹ä»¶ ${eventId}ï¼Ÿ\næ­¤æ“ä½œæœƒåŒæ™‚åˆªé™¤ç›¸é—œå½±ç‰‡ã€‚`)) {
        return;
    }
    
    try {
        const response = await fetch(`/api/events/${eventId}`, {
            method: 'DELETE'
        });
        
        if (response.ok) {
            alert('äº‹ä»¶å·²åˆªé™¤');
            location.reload();
        } else {
            const data = await response.json();
            alert(`åˆªé™¤å¤±æ•—: ${data.detail}`);
        }
    } catch (error) {
        alert(`åˆªé™¤å¤±æ•—: ${error.message}`);
    }
}
</script>
{% endblock %}
